<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>{{ name }} - 简历</title>
    <style>
        /* ================= Reset & Base ================= */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-print-color-adjust: exact; /* 强制打印背景色 */
            print-color-adjust: exact;
        }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden; /* 防止任何溢出滚动条 */
        }

        body {
            font-family: "PingFang SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #334155; /* text-slate-700 */
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }
        
        /* ... (中间样式保持不变) ... */

        /* ================= A4 Paper Layout ================= */
        @page {
            size: A4;
            margin: 0; /* 关键：强制移除打印机默认边距 */
        }

        .page-container {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            background: white;
            box-shadow: none;
            position: relative;
            
            /* 新增：Flexbox 垂直布局，实现智能填满 */
            display: flex;
            flex-direction: column;
        }

        /* 打印时去除阴影和外边距，并强制占满 */
        @media print {
            body {
                background: white;
            }
            .page-container {
                width: 100%;
                max-width: none;
                margin: 0;
                box-shadow: none;
                border: none;
            }
        }

        /* ================= Header Section ================= */
        .header {
            background-color: #1e293b;
            color: white;
            padding: 40px;
            
            /* 终极修复：绝对定位强制贴顶 */
            margin: 0; 
            border-top: 1px solid #1e293b; /* 物理填补白线 */
            
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-shrink: 0;
        }

        .header-left h1 {
            font-size: 36px; /* text-4xl */
            font-weight: 700;
            letter-spacing: 0.025em;
            margin-bottom: 8px;
        }

        .header-left p {
            font-size: 20px; /* text-xl */
            color: #cbd5e1; /* text-slate-300 */
            font-weight: 500;
        }

        .header-right {
            text-align: right;
            font-size: 14px; /* text-sm */
            color: #94a3b8; /* text-slate-400 */
            line-height: 1.6;
        }

        .header-right a:hover {
            color: white;
            text-decoration: underline;
        }

        /* ================= Content Section ================= */
        .content {
            padding: 40px;
            flex-grow: 1; /* 让内容区域自动占据剩余空间 */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* 关键：让各个 section 均匀分布 */
            gap: 20px; /* 最小间距 */
        }

        .section {
            margin-bottom: 0; /* 交给 flex gap 控制 */
        }

        .section-title {
            font-size: 20px; /* text-2xl is usually 24px, but 20px fits better for print */
            font-weight: 700;
            color: #1e293b; /* text-slate-800 */
            border-bottom: 2px solid #e2e8f0; /* border-slate-200 */
            padding-bottom: 8px;
            margin-bottom: 12px;
        }

        /* ================= Summary ================= */
        .summary-text {
            color: #475569; /* text-gray-600 */
            line-height: 1.625;
            text-align: justify;
        }

        /* ================= Skills (Concise) ================= */
        .skills-wrapper {
            font-size: 14px;
            color: #334155;
            line-height: 1.6;
            font-weight: 500;
        }
        
        .skill-separator {
            color: #cbd5e1; /* text-slate-300 */
            margin: 0 8px;
            font-weight: 300;
        }

        /* ================= Experience ================= */
        .experience-item {
            padding-bottom: 16px;
            border-bottom: 1px solid #f1f5f9; /* border-gray-100 */
            margin-bottom: 16px;
        }
        
        .experience-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .exp-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 8px;
        }

        .exp-title-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .exp-title {
            font-size: 16px; /* text-lg */
            font-weight: 700;
            color: #334155; /* text-slate-700 */
        }

        .exp-role {
            font-size: 12px;
            padding: 2px 8px;
            background-color: #eff6ff; /* bg-blue-50 */
            color: #2563eb; /* text-blue-600 */
            border: 1px solid #dbeafe; /* border-blue-100 */
            border-radius: 4px;
            font-weight: 500;
        }

        .exp-date {
            font-size: 14px; /* text-sm */
            color: #64748b; /* text-slate-500 */
            font-weight: 500;
        }

        .exp-tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .tech-tag {
            font-size: 10px;
            padding: 2px 6px;
            background-color: #f8fafc; /* bg-gray-50 */
            color: #64748b; /* text-gray-500 */
            border: 1px solid #f1f5f9; /* border-gray-100 */
            border-radius: 2px;
        }

        .exp-bullets {
            list-style-type: disc;
            list-style-position: outside;
            margin-left: 18px;
            color: #475569; /* text-gray-600 */
            font-size: 14px; /* text-sm */
            line-height: 1.6;
        }
        
        .exp-bullets li {
            margin-bottom: 4px;
        }

        /* ================= Education ================= */
        .education-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .edu-school {
            font-weight: 700;
            color: #334155;
        }

        .edu-details {
            font-size: 14px;
            color: #64748b;
        }
        
        .edu-honors {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 2px;
        }

        /* ================= Footer ================= */
        .footer {
            display: none;
        }

    </style>
</head>
<body>
    <div class="page-container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>{{ name }}</h1>
                <p>{{ title }}</p>
            </div>
            <div class="header-right">
                {% if contact.email %}<p>Email: {{ contact.email }}</p>{% endif %}
                {% if contact.github %}<p>GitHub: <a href="{{ contact.github }}">{{ contact.github }}</a></p>{% endif %}
                {% if contact.phone %}<p>Phone: {{ contact.phone }}</p>{% endif %}
                {% if contact.blog %}<p>Blog: <a href="{{ contact.blog }}">{{ contact.blog }}</a></p>{% endif %}
            </div>
        </div>

        <div class="content">
            <!-- Summary -->
            <section class="section">
                <h2 class="section-title">个人总结</h2>
                <p class="summary-text">{{ summary }}</p>
            </section>

            <!-- Skills -->
            <section class="section">
                <h2 class="section-title">技术栈</h2>
                <div class="skills-wrapper">
                    {% for skill in skills[:8] %}{{ skill }}{% if not loop.last %}<span class="skill-separator">•</span>{% endif %}{% endfor %}
                </div>
            </section>

            <!-- Experience -->
            <section class="section">
                <h2 class="section-title">项目经历</h2>
                <div>
                    {% for proj in experience %}
                    <div class="experience-item">
                        <div class="exp-header">
                            <div class="exp-title-row">
                                <h3 class="exp-title">{{ proj.project_name }}</h3>
                                <span class="exp-role">{{ proj.role }}</span>
                            </div>
                            <span class="exp-date">
                                {% if proj.start_date %}{{ proj.start_date }} - {% endif %}{{ proj.end_date if proj.end_date else '至今' }}
                            </span>
                        </div>
                        
                        <!-- Matched Skills Tags -->
                        {% if proj.matched_skills %}
                        <div class="exp-tech-stack">
                            {% for skill in proj.matched_skills %}
                            <span class="tech-tag">{{ skill }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <ul class="exp-bullets">
                            {% for bullet in proj.optimized_bullets %}
                            <li>{{ bullet }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <!-- Education -->
            <section class="section">
                <h2 class="section-title">教育背景</h2>
                <div>
                    {% for edu in education %}
                    <div class="education-item">
                        <div>
                            <h3 class="edu-school">{{ edu.school }}</h3>
                            <p class="edu-details">{{ edu.degree }} · {{ edu.major }}</p>
                            {% if edu.honors %}
                            <p class="edu-honors">荣誉: {{ edu.honors | join(', ') }}</p>
                            {% endif %}
                        </div>
                        <span class="exp-date">{{ edu.start_year }} - {{ edu.end_year }}</span>
                    </div>
                    {% endfor %}
                </div>
            </section>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p class="footer-text">Generated by Resume Agent</p>
            <div class="{{ 'score-high' if match_score >= 80 else ('score-mid' if match_score >= 60 else 'score-low') }}">
                JD Match Score: {{ match_score }}%
            </div>
        </div>
    </div>
</body>
</html>
